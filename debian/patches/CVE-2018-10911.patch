From: Markus Koschany <apo@debian.org>
Date: Wed, 19 Sep 2018 14:50:27 +0200
Subject: CVE-2018-10911

Origin: https://review.gluster.org/21067
---
 libglusterfs/src/dict.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/libglusterfs/src/dict.c b/libglusterfs/src/dict.c
index f2df5a6..838f68f 100644
--- a/libglusterfs/src/dict.c
+++ b/libglusterfs/src/dict.c
@@ -2573,6 +2573,13 @@ dict_unserialize (char *orig_buf, int32_t size, dict_t **fill)
                 vallen = ntoh32 (hostord);
                 buf += DICT_DATA_HDR_VAL_LEN;
 
+                if ((keylen < 0) || (vallen < 0) ||
+                        (buf + keylen) > (orig_buf + size)) {
+                        gf_log_callingfn ("dict", GF_LOG_ERROR,
+                                          "undersized length passed "
+                                          "key:%d val:%d", keylen, vallen);
+                        goto out;
+                }
                 if ((buf + keylen) > (orig_buf + size)) {
                         gf_log_callingfn ("dict", GF_LOG_ERROR,
                                           "undersized buffer passed. "
